import Head from 'next/head'
import Store from '../components/Store';

import { useDispatch, useSelector } from 'react-redux';
import { useEffect, useRef } from 'react';
import { calculateTotals, getProductsItems } from '../features/cart/cartSlice';;
import Navbar from '../components/Navbar';
import Skeleton from '../components/Skeleton';
import Footer from '../components/Footer';
import { AppDispatch } from '../store';
import { Wrapper } from '../components/Store/CardList/styled';
import Cart from '../components/Store/Cart';

export default function Home() {

  const { cartProducts, isLoading } = useSelector((store: any) => store.cart)
  const dispatch = useDispatch<AppDispatch>();

  useEffect(() => {
    dispatch(getProductsItems());
  }, [])

  useEffect(() => {
    dispatch(calculateTotals());
  }, [cartProducts]);

  if (isLoading) {
    return (
      <>
        <Navbar />
        <Wrapper>{[1, 2, 3, 4, 5, 6, 7, 8].map((product: any) => (
          <Skeleton key={product.id} width={280} height={270} borderRadius={8} marginTop={50} />
        ))}</Wrapper>
      </>
    )
  }

  return (
    <>
      <Head>
        <title>MKS sistemas</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Navbar />
      <Store />
      <Cart />
      <Footer />
    </>
  )
}
